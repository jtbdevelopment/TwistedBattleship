<!--  TODO - disable buttons if action pending  -->
<!--  TODO - disable if network down -->
<ion-view class="playGame" xmlns="http://www.w3.org/1999/html">
    <ion-nav-buttons side="right">
        <button class="button button-icon button-clear ion-help-circled" ng-click="showHelp()"></button>
    </ion-nav-buttons>
    <ion-content has-bouncing="false">
        <div class="row gameSummary" on-swipe="switchView(!showing)">
            <div class="col-33 item">
                <div ng-show="game.gamePhase === 'Playing'">
                    Current Turn:
                    <p><span
                            class="item-note {{gameDetails.playerCanPlay(game, player.md5) ? 'activePlayer' : 'inactivePlayer'}}">
                        {{game.players[game.currentPlayer]}} with {{game.remainingMoves}} moves.
                    </span></p>
                </div>
                <div ng-hide="game.gamePhase === 'Playing'">
                    <div class="{{(game.winningPlayer === player.md5) ? 'winner' : 'loser'}}">
                        Winner: <p><span class="item-note">{{game.players[game.winningPlayer]}}</span></p>
                    </div>
                </div>
            </div>
            <div class="col-33 item">
                General:
                <p><span class="item-note">{{game.generalMessage}}</span></p>
            </div>
            <div class="col-33 item">
                Last Move:
                <p><span class="item-note">{{game.maskedPlayersState.lastActionMessage}}</span>
            </div>
        </div>
        <div class="row">
            <div class="list col-20">
                <div class="item item-avatar {{showing == 'ALL' ? 'chosen' : ''}}"
                     ng-click="changePlayer('ALL')">
                    <img ng-src="{{gameDetails.imageForPlayer(game, player.md5)}}">

                    <h3 class="{{game.playersAlive[player.md5] == true ? 'active' : 'defeated'}}">
                        {{player.displayName}}</h3>

                    <p>Score: {{game.playersScore[player.md5]}}</p>
                </div>
                <div class="item item-divider">Opponents</div>
                <div ng-repeat="(md5, name) in game.players | orderBy:name"
                     class="item item-avatar {{showing == md5 ? 'chosen' : ''}}"
                     ng-click="changePlayer(md5)"
                     ng-hide="md5 === player.md5">
                    <img ng-src="{{gameDetails.imageForPlayer(game, md5)}}">

                    <h3 class="{{game.playersAlive[md5] == true ? 'active' : 'defeated'}}">{{name}}</h3>

                    <p>Score: {{game.playersScore[md5]}}</p>
                </div>
                <div ng-show="gameDetails.playerCanPlay(game, player.md5)">
                    <div class="item item-divider">Actions</div>
                    <div ng-show="showingSelf">
                        <div class="item action-item">
                            <div class="button-bar">
                                <button class="button button-defend icon-left ion-{{gameDetails.iconForFeature('ECMEnabled')}}"
                                        ng-disabled="!gameDetails.ecmPossible(game, player.md5)"
                                        ng-click="ecm()">
                                    <span>ECM</span>
                                </button>
                                <span class="badge">{{game.maskedPlayersState.ecmsRemaining}}</span>
                            </div>
                        </div>
                        <div class="item action-item">
                            <div class="button-bar">
                                <button class="button button-defend icon-left ion-{{gameDetails.iconForFeature('EMEnabled')}}"
                                        ng-disabled="!(gameDetails.evasiveMovePossible(game, player.md5) && shipHighlighted)"
                                        ng-click="move()">
                                    <span>Evade</span>
                                </button>
                                <span class="badge">{{game.maskedPlayersState.evasiveManeuversRemaining}}</span>
                            </div>
                        </div>
                        <div class="item action-item">
                            <div class="button-bar">
                                <button class="button button-defend icon-left ion-{{gameDetails.iconForFeature('EREnabled')}}"
                                        ng-disabled="!(gameDetails.repairPossible(game, player.md5) && shipHighlighted)"
                                        ng-click="repair()">
                                    <span>Repair</span>
                                </button>
                                <span class="badge">{{game.maskedPlayersState.emergencyRepairsRemaining}}</span>
                            </div>
                        </div>
                    </div>
                    <div ng-show="!showingSelf && game.playersAlive[showing] === true">
                        <div class="item action-item">
                            <div class="button-bar">
                                <button class="button button-attack icon-left ion-disc" ng-click="fire()">
                                    <span>Fire</span>
                                </button>
                                <span class="badge">{{game.remainingMoves}}</span>
                            </div>
                        </div>
                        <div class="item action-item">
                            <div class="button-bar">
                                <button class="button button-attack icon-left ion-{{gameDetails.iconForFeature('SpyEnabled')}}"
                                        ng-disabled="!gameDetails.spyPossible(game, player.md5)" ng-click="spy()">
                                    <span>Spy</span>
                                </button>
                                <span class="badge">{{game.maskedPlayersState.spysRemaining}}</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div ng-show="game.gamePhase === 'Playing'">
                    <div class="item item-divider">Quit</div>
                    <div class="item action-item">
                        <div class="button-bar">
                            <button class="button button-assertive quit icon-left ion-flag" ng-click="quit()">
                                <span>Surrender</span>
                            </button>
                        </div>
                    </div>
                </div>
                <div ng-show="game.gamePhase === 'RoundOver'">
                    <div class="item item-divider">Rematch?</div>
                    <div class="item action-item">
                        <div class="button-bar ">
                            <button class="button rematch icon-left ion-loop" ng-click="rematch()">
                                <span>Rematch</span>
                            </button>
                        </div>
                    </div>
                    <div class="item action-item">
                        <div class="button-bar ">
                            <button class="button endRematch icon-left ion-loop" ng-click="declineRematch()">
                                <span>End Rematches</span>
                            </button>
                        </div>
                    </div>
                </div>

            </div>
            <div class="col-80">
                <div class="row viewToggleRow">
                    <div class="button-bar">
                        <button class="button icon-left {{showingSelf ? 'ion-checkmark' : '' }} button-defend"
                                ng-click="switchView(true)">Their view of you
                        </button>
                        <button class="button icon-left {{showingSelf ? '' : 'ion-checkmark' }} button-attack"
                                ng-click="switchView(false)" ng-disabled="showing == 'ALL'">Your view of them
                        </button>
                    </div>
                </div>
                <div class="row">
                    <div id="phaser" class="phaser">

                    </div>
                </div>
            </div>
        </div>
    </ion-content>
</ion-view>